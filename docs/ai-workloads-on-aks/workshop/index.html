<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-ai-workloads-on-aks/workshop" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Containerizing and Deploying AI Workloads on AKS | AKS LABS</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://azure-samples.github.io/aks-labs/img/aks-labs-social-card.png"><meta data-rh="true" name="twitter:image" content="https://azure-samples.github.io/aks-labs/img/aks-labs-social-card.png"><meta data-rh="true" property="og:url" content="https://azure-samples.github.io/aks-labs/docs/ai-workloads-on-aks/workshop"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Containerizing and Deploying AI Workloads on AKS | AKS LABS"><meta data-rh="true" name="description" content="In this lab, you will learn all about deploying AI workloads on AKS Automatic cluster. We&#x27;ll start by running a containerized AI workload locally then deploy it to an AKS Automatic cluster. AKS Automatic is a new offering of AKS that simplifies the deployment of Kubernetes clusters. In a matter of minutes, you will have an enterprise ready Kubernetes cluster that is ready to run your AI workloads securely and at scale."><meta data-rh="true" property="og:description" content="In this lab, you will learn all about deploying AI workloads on AKS Automatic cluster. We&#x27;ll start by running a containerized AI workload locally then deploy it to an AKS Automatic cluster. AKS Automatic is a new offering of AKS that simplifies the deployment of Kubernetes clusters. In a matter of minutes, you will have an enterprise ready Kubernetes cluster that is ready to run your AI workloads securely and at scale."><link data-rh="true" rel="icon" href="/aks-labs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://azure-samples.github.io/aks-labs/docs/ai-workloads-on-aks/workshop"><link data-rh="true" rel="alternate" href="https://azure-samples.github.io/aks-labs/docs/ai-workloads-on-aks/workshop" hreflang="en"><link data-rh="true" rel="alternate" href="https://azure-samples.github.io/aks-labs/docs/ai-workloads-on-aks/workshop" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/aks-labs/blog/rss.xml" title="AKS LABS RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/aks-labs/blog/atom.xml" title="AKS LABS Atom Feed"><link rel="stylesheet" href="/aks-labs/assets/css/styles.56ddccda.css">
<script src="/aks-labs/assets/js/runtime~main.f1d0a99d.js" defer="defer"></script>
<script src="/aks-labs/assets/js/main.2f149359.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/aks-labs/img/aks-logo-icon.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/aks-labs/"><div class="navbar__logo"><img src="/aks-labs/img/aks-logo-icon.svg" alt="AKS Labs Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/aks-labs/img/aks-logo-icon.svg" alt="AKS Labs Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">AKS LABS</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/aks-labs/docs/intro">Workshops</a><a class="navbar__item navbar__link" href="/aks-labs/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/russd2357/aks-labs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/aks-labs/docs/intro">Workshop Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/aks-labs/docs/category/getting-started-with-k8s-on-aks">Getting Started with K8s on AKS</a><button aria-label="Expand sidebar category &#x27;Getting Started with K8s on AKS&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/aks-labs/docs/category/aks-automatic">AKS Automatic</a><button aria-label="Expand sidebar category &#x27;AKS Automatic&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/aks-labs/docs/category/operating-aks-automatic">Operating AKS Automatic</a><button aria-label="Expand sidebar category &#x27;Operating AKS Automatic&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/aks-labs/docs/category/advanced-aks">Advanced AKS</a><button aria-label="Expand sidebar category &#x27;Advanced AKS&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/aks-labs/docs/category/ai-on-aks">AI on AKS</a><button aria-label="Collapse sidebar category &#x27;AI on AKS&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/aks-labs/docs/ai-workloads-on-aks/workshop">Containerizing and Deploying AI Workloads on AKS</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/aks-labs/docs/category/tutorial---basics">Tutorial - Basics</a><button aria-label="Expand sidebar category &#x27;Tutorial - Basics&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/aks-labs/docs/category/tutorial---extras">Tutorial - Extras</a><button aria-label="Expand sidebar category &#x27;Tutorial - Extras&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/aks-labs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/aks-labs/docs/category/ai-on-aks"><span itemprop="name">AI on AKS</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Containerizing and Deploying AI Workloads on AKS</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Overview</h1></header>
<p>In this lab, you will learn all about deploying AI workloads on AKS Automatic cluster. We&#x27;ll start by running a containerized AI workload locally then deploy it to an AKS Automatic cluster. AKS Automatic is a new offering of AKS that simplifies the deployment of Kubernetes clusters. In a matter of minutes, you will have an enterprise ready Kubernetes cluster that is ready to run your AI workloads securely and at scale.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="objectives">Objectives<a href="#objectives" class="hash-link" aria-label="Direct link to Objectives" title="Direct link to Objectives">​</a></h2>
<p>The overall objective is to get you familiar with deploying apps to AKS Automatic clusters by doing the following:</p>
<ul>
<li>Preparing an application for deployment to AKS</li>
<li>Deploying an application to AKS using Automated Deployments</li>
<li>Configuring ingress for an application</li>
<li>Troubleshooting an application using AKS Container Insights</li>
<li>Configuring AKS Workload Identity with AKS Service Connector</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h2>
<p>Before you begin this lab, you will need the following tools installed on your machine (I know... it&#x27;s a lot 😅):</p>
<ul>
<li><a href="https://azure.microsoft.com/free" target="_blank" rel="noopener noreferrer">Azure subscription</a></li>
<li><a href="https://git-scm.com/downloads" target="_blank" rel="noopener noreferrer">Git</a></li>
<li><a href="https://www.python.org/downloads" target="_blank" rel="noopener noreferrer">Python</a></li>
<li><a href="https://jupyter.org/install" target="_blank" rel="noopener noreferrer">Jupyter</a></li>
<li><a href="https://nodejs.org/en/download" target="_blank" rel="noopener noreferrer">Node.js</a></li>
<li><a href="https://www.docker.com/get-started" target="_blank" rel="noopener noreferrer">Docker Desktop</a></li>
<li><a href="https://developer.hashicorp.com/terraform/install" target="_blank" rel="noopener noreferrer">Terraform</a></li>
<li><a href="https://learn.microsoft.com/cli/azure/install-azure-cli" target="_blank" rel="noopener noreferrer">Azure CLI</a></li>
<li><a href="https://learn.microsoft.com/azure/developer/azure-developer-cli/install-azd" target="_blank" rel="noopener noreferrer">Azure Developer CLI</a></li>
<li><a href="https://cli.github.com" target="_blank" rel="noopener noreferrer">GitHub CLI</a></li>
<li><a href="https://code.visualstudio.com" target="_blank" rel="noopener noreferrer">Visual Studio Code</a></li>
<li>POSIX compliant shell (e.g. bash, zsh)</li>
</ul>
<div class="info" data-title="Note"><blockquote>
<p>You can also run the lab in a GitHub Codespace or DevContainer. This environment has all the tools you need pre-installed. More on that in the next section.</p>
</blockquote></div>
<div class="important" data-title="Important"><blockquote>
<p>In order to deploy an AKS Automatic cluster, you will need to have at least 32 vCPU of Standard DSv2 quota available in the region you want to deploy the cluster. If you don&#x27;t have this quota available, you can request a quota increase in the Azure portal. Instructions on how to request a quota increase can be found <a href="https://learn.microsoft.com/azure/quotas/quickstart-increase-quota-portal" target="_blank" rel="noopener noreferrer">here</a>.</p>
</blockquote></div>
<hr>
<h1>Lab environment setup</h1>
<p>The application we will be deploying is a multi-agent creative writing assistant. The application will rely on multiple large language models hosted on <a href="https://learn.microsoft.com/azure/ai-services/openai/overview" target="_blank" rel="noopener noreferrer">Azure OpenAI</a> to generate content. But the content will not be generated automatically from scratch, it will rely on product catalog indexed in Azure AI Search and related content gathered from Bing Search. With content grounded in facts and real-world data, the AI agents will generate creative writing pieces that are both engaging and informative, then an editor agent will review and accept the final piece.</p>
<p>Here is a high-level overview of the application and the Azure resources that it relies on, which can also be found in the repo at <a href="https://github.com/pauldotyu/contoso-creative-writer/" target="_blank" rel="noopener noreferrer">https://github.com/pauldotyu/contoso-creative-writer/</a>.</p>
<p><img decoding="async" loading="lazy" src="https://raw.githubusercontent.com/pauldotyu/contoso-creative-writer/main/images/Creative_writing.png" alt="Solution architecture" class="img_ev3q"></p>
<p>This application relies on the services that you see listed in the diagram above with a few more to prepare for the AKS Automatic deployment. This workshop will include these additional Azure services:</p>
<ul>
<li>Azure Container Registry</li>
<li>Azure Log Analytics</li>
<li>Azure Monitor (Prometheus)</li>
<li>Azure Managed Grafana</li>
<li>Container Insights</li>
<li>Azure Key Vault</li>
<li>Azure DNS</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fork-and-clone-the-repo">Fork and clone the repo<a href="#fork-and-clone-the-repo" class="hash-link" aria-label="Direct link to Fork and clone the repo" title="Direct link to Fork and clone the repo">​</a></h2>
<p>Start by forking the repo to your GitHub account. You can use the GitHub CLI.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># authenticate to GitHub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gh auth login --scopes repo,workflow,write:packages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># fork the repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gh repo fork pauldotyu/contoso-creative-writer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Next, open your forked repo with GitHub Codespaces. Navigate to the repo in the GitHub UI and click on the Code button. Click on the <strong>Codespaces</strong> tab, then click <strong>Create codespace on main</strong>.</p>
<p><img decoding="async" loading="lazy" alt="Open repo with GitHub Codespace" src="/aks-labs/assets/images/open-in-codespace-66820810f3e81c7de889cb51ffdc4a7f.png" width="2506" height="1391" class="img_ev3q"></p>
<div class="info" data-title="Note"><blockquote>
<p>If you want to use a DevContainer, clone the repo to your local machine and open it in Visual Studio Code. You should be prompted to open the repo in a DevContainer.</p>
</blockquote></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-azure-resources">Deploy Azure Resources<a href="#deploy-azure-resources" class="hash-link" aria-label="Direct link to Deploy Azure Resources" title="Direct link to Deploy Azure Resources">​</a></h2>
<p>As mentioned above, the application relies on a few Azure resources. We will use the existing Terraform configuration that is included in the repo and invoke the Terraform CLI using the Azure Developer CLI (AZD).</p>
<p>Run the following commands to set up the lab environment.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># login to Azure CLI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">az login</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># login to Azure Developer CLI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">azd auth login</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># create a new AZD environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">azd env new</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># set the Azure subscription to use</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">azd env set AZURE_SUBSCRIPTION_ID $(az account show --query id -o tsv)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># set the Azure location that has all services and vCPU quota available for the workshop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">azd env set AZURE_LOCATION &quot;francecentral&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># provision the Azure resources</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">azd provision</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># set environment variables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">azd env get-values | awk &#x27;{gsub(/&quot;/, &quot;&quot;)}1&#x27; &gt; .env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># set environment variables in the current shell</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source .env</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h1>Runs on my machine!</h1>
<p>Great! We&#x27;ve quickly provisioned all the Azure resources needed to support this application. We can verify the application works locally before deploying it to containers, then to the cloud.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="local-development">Local development<a href="#local-development" class="hash-link" aria-label="Direct link to Local development" title="Direct link to Local development">​</a></h2>
<p>The repo includes two applications: a backend api and a web frontend.</p>
<p>The backend api is a Python based application and we can run the following commands in a terminal to start the api locally.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># make sure you are in the root of the repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd src/api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># create a virtual environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python -m venv .venv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># activate the virtual environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source .venv/bin/activate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># install the dependencies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip install -r requirements.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># copy the .env file from the root of the repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp ../../.env .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># start the api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.venv/bin/gunicorn -c gunicorn.conf.py api.app:app</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>With the api running, open a new terminal and start the web app. The web app is a Node.js application and we can run the following commands.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># make sure you are in the root of the repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd src/web</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># install the dependencies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># start the web app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm run dev</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="test-the-application">Test the application<a href="#test-the-application" class="hash-link" aria-label="Direct link to Test the application" title="Direct link to Test the application">​</a></h2>
<p>Browse to <a href="http://localhost:5173" target="_blank" rel="noopener noreferrer">http://localhost:5173</a></p>
<p>Click the <strong>Try an Example</strong> button, then click <strong>Get to Work!</strong>.</p>
<p><img decoding="async" loading="lazy" alt="Try an example" src="/aks-labs/assets/images/local-try-an-example-eb2969c837770e03f51a0db05523f3ac.png" width="2513" height="1367" class="img_ev3q"></p>
<p>You should see the Agents working on the task and if you navigate back into your terminal, you should see logs from the api service that shows the task being processed.</p>
<p><img decoding="async" loading="lazy" alt="Creative agents in action" src="/aks-labs/assets/images/agents-in-action-857698af98b76232b2183f4e445f2b34.png" width="2558" height="1439" class="img_ev3q"></p>
<p>After a few minutes, you should see the status of <strong>Editor accepted article</strong>.</p>
<p><img decoding="async" loading="lazy" alt="Creative agents accepted article" src="/aks-labs/assets/images/agents-accepted-article-4b605d238cae6e408bc99f646ecd9ebd.png" width="2558" height="1439" class="img_ev3q"></p>
<p>Click the <strong>Document</strong> tab to see the final document.</p>
<p><img decoding="async" loading="lazy" alt="Creative agents created article" src="/aks-labs/assets/images/agents-created-article-98333a8d977503be981593cbf6ee0044.png" width="2558" height="1439" class="img_ev3q"></p>
<p>After you have verified the application works locally, you can stop the applications by pressing <code>Ctrl+C</code> in both terminals.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="containerize-the-application">Containerize the application<a href="#containerize-the-application" class="hash-link" aria-label="Direct link to Containerize the application" title="Direct link to Containerize the application">​</a></h2>
<p>Next step is to ensure the applications can run in containers. The repo includes Dockerfiles for both the api and web projects. A <a href="https://docs.docker.com/get-started/docker-concepts/building-images/writing-a-dockerfile/" target="_blank" rel="noopener noreferrer">Dockerfile</a> is a manifest that describes how to build a container image. To run a container you need to build an image from the Dockerfile and then run the image in a container.</p>
<p>When running multi-container applications, it is common to use Docker Compose. <a href="https://docs.docker.com/compose/" target="_blank" rel="noopener noreferrer">Docker Compose</a> enables you to easily define the services that make up your application in a <code>docker-compose.yml</code> file. In this file, you can define the services, networks, volumes, and environment variables for your application. This is a common workflow for developing and testing multi-container applications locally.</p>
<div class="tip" data-title="tip"><blockquote>
<p>Understanding how the docker-compose.yml file is structured is beneficial when deploying multi-container applications to Kubernetes.</p>
</blockquote></div>
<p>Open a new terminal and run the following commands to build and start the applications in containers.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># make sure you are in the root of the repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker compose up --build</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="info" data-title="Note"><blockquote>
<p>While the containers build and start, let&#x27;s move on to take a look at the Docker Compose file to understand how the applications are configured to run in containers.</p>
</blockquote></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="exploring-the-docker-compose-file">Exploring the Docker Compose file<a href="#exploring-the-docker-compose-file" class="hash-link" aria-label="Direct link to Exploring the Docker Compose file" title="Direct link to Exploring the Docker Compose file">​</a></h3>
<p>The Docker Compose file begins with a <strong>services</strong> stanza. Here is where you define the services that make up your application. In this case, we have two services: api and web.</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Within the <strong>services</strong> stanza are the configurations for each service. For example, the api service is defined as follows:</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">api</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">context</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> src/api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">dockerfile</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Dockerfile.local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;5000:5000&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">env_file</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> .env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> PYTHONUNBUFFERED=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $HOME/.azure/</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/root/.azure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <strong>build</strong> stanza specifies the context and Dockerfile to use to build the image. There is a special Dockerfile.local file that is used to build the image specifically for running the container locally (more on that in a bit). The <strong>ports</strong> stanza specifies the port mapping between the host and the container. Remember the api service is running on port 5000. The <strong>env_file</strong> stanza loads the local <strong>.env</strong> file to load into the container. The <strong>environment</strong> stanza specifies individual environment variables to set in the container. Finally we get to the <strong>volumes</strong> stanza. Here we mount the local Azure CLI directory into the container so that the container can access your Azure CLI credentials for authentication.</p>
<div class="info" data-title="Note"><blockquote>
<p>A special Dockerfile is used to test the API container locally because of the fact that the API service is written to authenticate to Azure services the Azure Identity SDK in a passwordless manner. More specifically, it uses the DefaultAzureCredential class which tries several different methods to authenticate, ranging from environment variables, workload identity, and Azure CLI credentials.</p>
<p>In this case, the easiest way to authenticate from a local container is by using the Azure CLI credentials. However, the Azure CLI is not installed in the container by default, so a special Dockerfile.local is leveraged which installs the Azure CLI in the container.</p>
</blockquote></div>
<p>The web service is defined similarly:</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">web</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">context</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> src/web</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;3000:80&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> api</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <strong>depends_on</strong> stanza specifies that the web service depends on the api service. This means that the api service will start before the web service starts.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="test-the-application-1">Test the application<a href="#test-the-application-1" class="hash-link" aria-label="Direct link to Test the application" title="Direct link to Test the application">​</a></h2>
<p>Browse to <a href="http://localhost:3000" target="_blank" rel="noopener noreferrer">http://localhost:3000</a> and test the application as you did before.</p>
<p>Press <code>Ctrl+C</code> to stop the containers.</p>
<hr>
<h1>Runs on all machines!</h1>
<p>So we know the app works locally, both as standalone applications and within containers. Once we know the app works within containers, we can be <em>pretty</em> sure that it&#x27;ll work on all machines, and in our case, Kubernetes clusters.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-aks-automatic-cluster">Deploy AKS Automatic cluster<a href="#deploy-aks-automatic-cluster" class="hash-link" aria-label="Direct link to Deploy AKS Automatic cluster" title="Direct link to Deploy AKS Automatic cluster">​</a></h2>
<p><a href="https://aka.ms/aks/automatic" target="_blank" rel="noopener noreferrer">AKS Automatic</a> greatly simplifies the design and deployment of Kubernetes clusters. Many of the design decisions that you would need to make when deploying a traditional AKS cluster are made and managed for you. This includes the network plugin, the authentication and authorization mode, and the monitoring and logging configuration, node pool configuration, and more.</p>
<p>Let&#x27;s use the Azure portal to deploy an AKS Automatic cluster.</p>
<p>Navigate to the <a href="https://portal.azure.com" target="_blank" rel="noopener noreferrer">Azure Portal</a> and search for <strong>kubernetes</strong> in the search bar.</p>
<p>Click on the <strong>Kubernetes services</strong> link under <strong>Services</strong>, click on the <strong>Create</strong> button, and then click on the <strong>Automatic Kubernetes cluster (preview)</strong> button.</p>
<p><img decoding="async" loading="lazy" alt="Create AKS Automatic cluster" src="/aks-labs/assets/images/create-aks-automatic-e3062f503942831acea9ff13a7f5da6f.png" width="674" height="734" class="img_ev3q"></p>
<p>In the <strong>Basics</strong> tab, enter the following details:</p>
<ul>
<li><strong>Subscription</strong>: Select your Azure subscription</li>
<li><strong>Resource group</strong>: Select the resource group you created earlier</li>
<li><strong>Kubernetes cluster name</strong>: aks-learnlive</li>
<li><strong>Region</strong>: Select the region your resource group is in</li>
</ul>
<p>You can leave the rest of the settings as default then click <strong>Next</strong>.</p>
<p>In the <strong>Monitoring</strong> tab, note that monitoring, logging, and alerts are enabled by default. Since we have existing Azure Monitor, Azure Log Analytics, and Azure Managed Grafana resources, it automatically populated the dropdowns for you. Pretty awesome, right?</p>
<p>Click <strong>Review + create</strong>, wait for the validation to complete, then click <strong>Create</strong>. It&#x27;ll take a few minutes to deploy the AKS Automatic cluster.</p>
<p>Once the deployment is complete, click the <strong>Go to resource</strong> button to navigate to the AKS cluster.</p>
<p><img decoding="async" loading="lazy" alt="AKS Automatic cluster" src="/aks-labs/assets/images/aks-automatic-created-f991c1237c77c1a05a88280152d0006a.png" width="2510" height="1368" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="publish-container-images">Publish container images<a href="#publish-container-images" class="hash-link" aria-label="Direct link to Publish container images" title="Direct link to Publish container images">​</a></h2>
<p>Before we attempt to run the application containers in a Kubernetes cluster, we&#x27;ll need to put our container images in a container registry. Common registries include <a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">Docker Hub</a>, <a href="https://learn.microsoft.com/azure/container-registry/" target="_blank" rel="noopener noreferrer">Azure Container Registry (ACR)</a>, or <a href="https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry" target="_blank" rel="noopener noreferrer">GitHub Container Registry (GHCR)</a> just to name a few.</p>
<p>In order for your AKS cluster to pull images from ACR, you need to grant the AKS cluster access to the ACR instance.</p>
<p>Use the Azure CLI to give the AKS cluster access to ACR. Run the following command in the terminal to grant the AKS cluster access to ACR.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># run this in the root of the repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source .env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># get the AKS cluster name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AZURE_KUBERNETES_SERVICE_NAME=$(az aks list -g $AZURE_RESOURCE_GROUP --query &quot;[0].name&quot; -o tsv)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># update the AKS cluster and attach the container registry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">az aks update --resource-group $AZURE_RESOURCE_GROUP --name $AZURE_KUBERNETES_SERVICE_NAME --attach-acr $AZURE_CONTAINER_REGISTRY_NAME</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="info" data-title="Note"><blockquote>
<p>This can take a few minutes to complete. Move on and come back to this step later.</p>
</blockquote></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="application-configuration">Application configuration<a href="#application-configuration" class="hash-link" aria-label="Direct link to Application configuration" title="Direct link to Application configuration">​</a></h2>
<p>We saw in the docker compose file, the <strong>.env</strong> file directly into the api container. We won&#x27;t have this luxury in AKS. Instead we need to pass the environment variables to the container at runtime and we can do this using a <a href="https://kubernetes.io/docs/concepts/configuration/configmap/" target="_blank" rel="noopener noreferrer">ConfigMap</a>. The good news is that we can quickly create a ConfigMap from the <strong>.env</strong> file to start.</p>
<p>Open a new terminal and get the kubeconfig file which allows you to log into the AKS cluster.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># run this in the root of the repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source .env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># get the AKS cluster name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export AZURE_KUBERNETES_SERVICE_NAME=$(az aks list -g $AZURE_RESOURCE_GROUP --query &quot;[0].name&quot; -o tsv)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># get the kubeconfig file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">az aks get-credentials --resource-group $AZURE_RESOURCE_GROUP --name $AZURE_KUBERNETES_SERVICE_NAME</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="important" data-title="Important"><blockquote>
<p>If you get an error about not having kubelogin installed, you can install it by running the following command:
<code>sudo az aks install-cli</code></p>
</blockquote></div>
<p>Run a command to verify that you are connected to the AKS cluster.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create namespace ccw</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Since this is the first time you are connecting to the AKS cluster, you will be prompted to log in to the AKS cluster using Microsoft Entra ID.</p>
<p>After you&#x27;ve authenticated, run the following command to create a ConfigMap from the local .env file.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create configmap ccw-config -n ccw --from-env-file .env</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Confirm the ConfigMap was created and view the contents.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get configmap ccw-config -n ccw -o yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="warning" data-title="Warning"><blockquote>
<p>There are configs here that should really be secrets. This is not best practice, but let&#x27;s just get the app running for now.</p>
</blockquote></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="automated-deployments">Automated deployments<a href="#automated-deployments" class="hash-link" aria-label="Direct link to Automated deployments" title="Direct link to Automated deployments">​</a></h2>
<p>The easiest way to deploy apps to AKS is to use the Azure portal.</p>
<p>AKS has a feature called <a href="https://learn.microsoft.com/azure/aks/automated-deployments" target="_blank" rel="noopener noreferrer">Automated Deployments</a> that allows you to deploy applications to your AKS cluster directly from GitHub. This feature uses <a href="https://docs.github.com/actions" target="_blank" rel="noopener noreferrer">GitHub Actions</a> to build container images, push them into ACR, then deploy it to your AKS cluster.</p>
<p>When you setup an Automated Deployment, it will do the following:</p>
<ol>
<li>Create a Service Principal in your Microsoft Entra tenant</li>
<li>Assign Azure RBAC permissions to the Service Principal</li>
<li>Configure a federated credential for your GitHub repository which allows the GitHub Actions to authenticate to your Azure subscription and deploy the application to your AKS cluster</li>
<li>Create a GitHub Actions workflow file in your GitHub repository that builds the container image, pushes it to ACR, and deploys an updated manifest to your AKS cluster</li>
</ol>
<p>Having a pipeline set up makes it very easy to deploy new versions of your application. Any changes to the code will trigger a new deployment.</p>
<p>You will need to configure an Automated Deployment for the <strong>api</strong> app and the <strong>web</strong> app separately.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-the-api-app">Deploy the api app<a href="#deploy-the-api-app" class="hash-link" aria-label="Direct link to Deploy the api app" title="Direct link to Deploy the api app">​</a></h3>
<p>Navigate to your AKS cluster in the Azure portal.</p>
<p>Click on <strong>Automated deployments</strong> under <strong>Settings</strong></p>
<p><img decoding="async" loading="lazy" alt="Automated deployments" src="/aks-labs/assets/images/aks-automated-deployments-fbf837c8785f66ea1d07741072c3313a.png" width="2514" height="1373" class="img_ev3q"></p>
<p>Click the <strong>Create an automated deployment</strong> button, then click <strong>Deploy an application</strong> option</p>
<p><img decoding="async" loading="lazy" alt="Create automated deployment" src="/aks-labs/assets/images/aks-create-automated-deployment-cb5d514d8a7fcd253e9b7d986f9bbd5d.png" width="2511" height="1366" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="Deploy an application" src="/aks-labs/assets/images/aks-deploy-an-app-6202b75ac009bf298ad9f2666e55dc46.png" width="2511" height="1367" class="img_ev3q"></p>
<div class="info" data-title="Note"><blockquote>
<p>Automated deployments is currently in preview and only supports GitHub repositories.</p>
</blockquote></div>
<p>Fill in the following details.</p>
<p>In the <strong>Repository</strong> tab:</p>
<ul>
<li><strong>Workflow name:</strong> ccw-api</li>
<li><strong>Repository location:</strong> GitHub (you may need to authenticate to GitHub)</li>
<li><strong>Repository source:</strong> My repositories</li>
<li><strong>Repository:</strong> Select your forked repo from the dropdown</li>
<li><strong>Branch:</strong> Select <strong>main</strong> from the dropdown</li>
</ul>
<p><img decoding="async" loading="lazy" alt="Automated deployments repo setup" src="/aks-labs/assets/images/ccw-api-repo-e62fbb24fb2ad71eabea901b4dbc42ed.png" width="2512" height="1365" class="img_ev3q"></p>
<p>In the <strong>Image</strong> tab:</p>
<ul>
<li><strong>Dockerfile:</strong> Click select and choose the existing <strong>Dockerfile</strong> in the <code>src/api</code> directory, then click <strong>Select</strong></li>
<li><strong>Dockerfile build context:</strong> <code>./src/api</code></li>
<li><strong>Azure Container Registry:</strong> Select your ACR from the dropdown</li>
<li><strong>Azure Container Registry image:</strong> Click the <strong>Create new</strong> link and enter <code>api</code> as the image name</li>
</ul>
<p><img decoding="async" loading="lazy" alt="Automated deployments image setup" src="/aks-labs/assets/images/ccw-api-image-e62fbb24fb2ad71eabea901b4dbc42ed.png" width="2512" height="1365" class="img_ev3q"></p>
<p>In the <strong>Deployment</strong> details tab:</p>
<ul>
<li><strong>Deployment options:</strong> Click on <strong>Kubernetes manifests files</strong></li>
<li><strong>Manifest files:</strong> Click the <strong>Select</strong> link, navigate to the <code>infra/manifests/api</code> directory, check the <strong>deployment.yaml</strong> file, then click the <strong>Select</strong> button</li>
<li><strong>Namespace:</strong> Select <strong>ccw</strong> from the dropdown</li>
</ul>
<div class="info" data-title="Note"><blockquote>
<p>AKS Automated Deployments can create Kubernetes manifests for you. However, in this lab, we are using the existing manifests in the repo.</p>
</blockquote></div>
<p><img decoding="async" loading="lazy" alt="Automated deployments manifest setup" src="/aks-labs/assets/images/ccw-api-manifest-3d5d6159027373a15631bb1e64cc5690.png" width="2512" height="1369" class="img_ev3q"></p>
<div class="important" data-title="Important"><blockquote>
<p>The Automated Deployment generates a GitHub workflow file. In the workflow, the last workflow step uses the <a href="https://github.com/Azure/k8s-deploy?tab=readme-ov-file#action-inputs" target="_blank" rel="noopener noreferrer">Azure/k8s-deploy</a> action to update the image to the most current version that was built and pushed in an earlier step. In order for this to work properly, the image MUST have the same container registry name and repository name as the one the workflow will be producing. There is a pattern match that occurs as part of the image update process on deployment so we need to ensure the existing manifest reflects the proper container registry and repository name. The tag can be anything as it will be updated by the workflow.</p>
</blockquote></div>
<p>Open a new terminal and update the deployment.yaml file in the <code>infra/manifests/api</code> directory to reflect the image name that will be similar to what will be created by the Automated Deployment.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># run this in the root of the repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source .env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i &quot;s|image: .*|image: ${AZURE_CONTAINER_REGISTRY_NAME}.azurecr.io/api:latest|&quot; infra/manifests/api/deployment.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i &quot;s|image: .*|image: ${AZURE_CONTAINER_REGISTRY_NAME}.azurecr.io/web:latest|&quot; infra/manifests/web/deployment.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Commit the changes to the deployment.yaml file.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git pull</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git add infra/manifests/api/deployment.yaml infra/manifests/web/deployment.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git commit -m &quot;Update image name in deployment.yaml files&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git push</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the <strong>Review</strong> tab, review the deployment details then click <strong>Next: Deploy</strong></p>
<p>This will create a new pull request in your forked repo.</p>
<p>When ready, click the <strong>Approve pull request</strong> button</p>
<p><img decoding="async" loading="lazy" alt="Automated deployments workflow setup" src="/aks-labs/assets/images/ccw-api-pr-cf219607d521741cd8a42eacdab96c95.png" width="2513" height="1371" class="img_ev3q"></p>
<p>In the GitHub Pull request review page, click on the <strong>Files changed</strong> tab and view the workflow file that will be added to your repo. You can see that the workflow file has two jobs: one to build the container image and push it to ACR, and another to deploy the image to the AKS cluster.</p>
<p>Click on the <strong>Conversation</strong> tab and click the <strong>Merge pull request</strong> button.</p>
<p><img decoding="async" loading="lazy" alt="Automated deployments pr merge" src="/aks-labs/assets/images/ccw-api-pr-merge-f70dacced35b56db8138cf534b91ade8.png" width="2511" height="1371" class="img_ev3q"></p>
<p>Click the <strong>Confirm merge</strong> button, then click the <strong>Delete branch</strong> button.</p>
<p>Navigate back to the Azure portal and click the <strong>Close</strong> button to close the Automated deployment for the api app and you will see the deployment in progress.</p>
<p><img decoding="async" loading="lazy" alt="Automated deployments progress" src="/aks-labs/assets/images/ccw-api-ad-progress-c555cbd7e00a74d83522ea3c1b05df4f.png" width="2515" height="1370" class="img_ev3q"></p>
<p>Repeat the same steps for the web app.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-the-web-app">Deploy the web app<a href="#deploy-the-web-app" class="hash-link" aria-label="Direct link to Deploy the web app" title="Direct link to Deploy the web app">​</a></h3>
<p>Click the Create button at the top of the <strong>Automated deployments</strong> blade, then click <strong>Deploy an application</strong> option</p>
<p><img decoding="async" loading="lazy" alt="Automated deployments web app deploy" src="/aks-labs/assets/images/ccw-web-deploy-an-app-5d2bdd740bea2fccee857657b3ebb9c6.png" width="2513" height="1370" class="img_ev3q"></p>
<p>Fill in the following details.</p>
<p>In the <strong>Repository</strong> tab:</p>
<ul>
<li><strong>Workflow name:</strong> ccw-web</li>
<li><strong>Repository location:</strong> GitHub</li>
<li><strong>Repository source:</strong> My repositories</li>
<li><strong>Repository:</strong> Select your forked repo from the dropdown</li>
<li><strong>Branch:</strong> Select <strong>main</strong> from the dropdown</li>
</ul>
<p><img decoding="async" loading="lazy" alt="Automated deployments repo setup" src="/aks-labs/assets/images/ccw-web-repo-c0131509d37e7777a3262272a659c458.png" width="2512" height="1370" class="img_ev3q"></p>
<p>In the <strong>Image</strong> tab:</p>
<ul>
<li><strong>Dockerfile:</strong> Click select and choose the <strong>Dockerfile</strong> in the <code>src/web</code> directory, then click <strong>Select</strong></li>
<li><strong>Dockerfile build context:</strong> <code>./src/web</code></li>
<li><strong>Azure Container Registry:</strong> Select your ACR from the dropdown</li>
<li><strong>Azure Container Registry image:</strong> Click the <strong>Create new</strong> link and enter <code>web</code> as the image name</li>
</ul>
<p><img decoding="async" loading="lazy" alt="Automated deployments image setup" src="/aks-labs/assets/images/ccw-web-image-405ce33063916b1f4247fd184d867762.png" width="2512" height="1371" class="img_ev3q"></p>
<p>In the Deployment details tab:</p>
<ul>
<li><strong>Deployment options:</strong> Click on <strong>Kubernetes manifests files</strong></li>
<li><strong>Manifest files:</strong> Click the <strong>Select</strong> link, navigate to the <code>infra/manifests/web</code> directory, check the <strong>deployment.yaml</strong> file, then click <strong>Select</strong></li>
<li><strong>Namespace:</strong> Select <strong>ccw</strong> from the dropdown</li>
</ul>
<p><img decoding="async" loading="lazy" alt="Automated deployments manifest setup" src="/aks-labs/assets/images/ccw-web-manifest-a3c2f135740fb25c82002f1203d7fd83.png" width="2514" height="1369" class="img_ev3q"></p>
<p>In the <strong>Review</strong> tab, review the deployment details, then click <strong>Next: Deploy</strong></p>
<p>This will create another new pull request in your forked repo. Review and merge the pull request as you did for the <strong>api</strong> app.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="confirm-deployment">Confirm deployment<a href="#confirm-deployment" class="hash-link" aria-label="Direct link to Confirm deployment" title="Direct link to Confirm deployment">​</a></h3>
<p>In the GitHub page, click on the <strong>Actions</strong> tab to view the deployment progress for workflows. Click on the workflow run to view the details of the deployment.</p>
<p><img decoding="async" loading="lazy" alt="Automated deployments workflow runs" src="/aks-labs/assets/images/github-actions-cc0209f3ae1aa8af4779a52781d367e2.png" width="2487" height="1391" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configure-ingress">Configure ingress<a href="#configure-ingress" class="hash-link" aria-label="Direct link to Configure ingress" title="Direct link to Configure ingress">​</a></h2>
<p>As mentioned earlier, AKS Automatic makes several design decisions for you. One of those decisions is to use the <a href="https://learn.microsoft.com/azure/aks/app-routing" target="_blank" rel="noopener noreferrer">AKS App Routing Add-On</a> for ingress. This add-on provides a fully managed NGINX ingress controller that is automatically deployed to your AKS cluster. All you need to do is configure the ingress resource to route traffic to your applications.</p>
<p>This can also be achieved from the Azure portal.</p>
<p>Navigate to the AKS cluster, click on the <strong>Services and ingresses</strong> tab</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-ingress-for-web-service">Configure ingress for web service<a href="#configure-ingress-for-web-service" class="hash-link" aria-label="Direct link to Configure ingress for web service" title="Direct link to Configure ingress for web service">​</a></h3>
<p>Right-click on the <strong>web</strong> service, then click the <strong>Add ingress</strong> button.</p>
<p><img decoding="async" loading="lazy" alt="Create web ingress" src="/aks-labs/assets/images/ingress-add-web-9430ebf70a7642c239329f2fd5622584.png" width="2511" height="1368" class="img_ev3q"></p>
<p>In the <strong>Basic</strong> tab, enter the following details:</p>
<ul>
<li><strong>Ingress name:</strong> web</li>
<li><strong>Namespace:</strong> ccw</li>
<li><strong>Service:</strong> web</li>
<li><strong>Key vault and primary certificate:</strong> Click the <strong>Select a certificate</strong> link then select the key vault and self-signed certificate that has been created for you</li>
<li><strong>DNS provider:</strong> Select Azure DNS</li>
<li><strong>Azure DNS Zone:</strong> Select the Azure DNS zone that has been created for you</li>
<li><strong>Subdomain name:</strong> ccw</li>
</ul>
<p>Click <strong>Review + create</strong>, then click <strong>Create</strong>.</p>
<p><img decoding="async" loading="lazy" alt="Configure web ingress" src="/aks-labs/assets/images/ingress-configure-web-8c5991e13dcde9610c55432580cc5dd6.png" width="2508" height="1370" class="img_ev3q"></p>
<p>This will take a few minutes to create the ingress resource.</p>
<p>When it is complete, click the <strong>Close</strong> button and configure the ingress for the api service.</p>
<p><img decoding="async" loading="lazy" alt="Completed web ingress" src="/aks-labs/assets/images/ingress-complete-web-4b895f35b32227c7fe2439f77292a2af.png" width="2512" height="1370" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-ingress-for-api-service">Configure ingress for api service<a href="#configure-ingress-for-api-service" class="hash-link" aria-label="Direct link to Configure ingress for api service" title="Direct link to Configure ingress for api service">​</a></h3>
<p>Right-click on the <strong>api</strong> service, then click the <strong>Add ingress</strong> button.</p>
<p>In the <strong>Basic</strong> tab, enter the following details:</p>
<ul>
<li><strong>Ingress name:</strong> api</li>
<li><strong>Namespace:</strong> ccw</li>
<li><strong>Service:</strong> api</li>
<li><strong>Key vault and primary certificate:</strong> Click the <strong>Select a certificate</strong> link then select the key vault and self-signed certificate that has been created for you</li>
<li><strong>DNS provider:</strong> Select Azure DNS</li>
<li><strong>Azure DNS Zone:</strong> Select the Azure DNS zone that has been created for you</li>
<li><strong>Subdomain name:</strong> ccw</li>
</ul>
<p>Click <strong>Review + create</strong>, then click <strong>Create</strong>.</p>
<p>This will take a few minutes to create the ingress resource.</p>
<p>When it is complete, click the <strong>Close</strong> button.</p>
<p><img decoding="async" loading="lazy" alt="Completed api ingress" src="/aks-labs/assets/images/ingress-complete-api-8c228651cee0ab8e5aa875165389cf0e.png" width="2509" height="1369" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-azure-copilot-to-fix-the-api-ingress">Use Azure Copilot to fix the api ingress<a href="#use-azure-copilot-to-fix-the-api-ingress" class="hash-link" aria-label="Direct link to Use Azure Copilot to fix the api ingress" title="Direct link to Use Azure Copilot to fix the api ingress">​</a></h3>
<p>Did you notice something about this api ingress configuration?</p>
<p>It&#x27;s pointing to the same subdomain as the web ingress. This is because the api service is expected to be on the same subdomain but a different path <code>/api</code>. We need to update the api service to listen on the <code>/api</code> path.</p>
<p>Click on the <strong>Ingresses</strong> tab, then click on the <strong>api</strong> ingress.</p>
<p><img decoding="async" loading="lazy" alt="Fix ingress" src="/aks-labs/assets/images/fix-ingress-e0a7b4dee3e97e285366e1bf30af2c5c.png" width="2510" height="1368" class="img_ev3q"></p>
<p>Click on the <strong>YAML</strong> tab.</p>
<p>Click on the <strong>Copilot</strong> to bring up the Azure Copilot prompt, and put your cursor in the text box.</p>
<p><img decoding="async" loading="lazy" alt="Fix ingress with copilot" src="/aks-labs/assets/images/fix-ingress-with-copilot-d7bc180aade48ee6a4e48e914f686b43.png" width="2510" height="1369" class="img_ev3q"></p>
<p>Copy and paste the following prompt into the text box, then click the <strong>Send</strong> button.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">update this ingress to listen on any request to /api path and add annotation to rewrite the url to remove /api to backend pods</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Wait for Azure Copilot to suggest YAML file edits.</p>
<p><img decoding="async" loading="lazy" alt="Fix ingress with copilot thinking" src="/aks-labs/assets/images/fix-ingress-with-copilot-thinking-c99d571c48b3aa59a942f214bd8e5432.png" width="2509" height="1370" class="img_ev3q"></p>
<p>You should see Azure Copilot suggesting the following:</p>
<ul>
<li>Add annotations <code>nginx.ingress.kubernetes.io/rewrite-target: /$2</code> and <code>nginx.ingress.kubernetes.io/use-regex: &quot;true&quot;</code></li>
<li>Path be updated to <code>- path: /api(/|$)(.*)</code> with <code>pathType: ImplementationSpecific</code></li>
</ul>
<p><img decoding="async" loading="lazy" alt="Fix ingress with copilot suggestions" src="/aks-labs/assets/images/fix-ingress-with-copilot-answer-d2bcac1136ccafa3b8e87bf9ac25fa72.png" width="2510" height="1369" class="img_ev3q"></p>
<p>These configs will rewrite the url to remove the <code>/api</code> path when sending the request to the backend pods.</p>
<p>Make the necessary changes to the YAML file, then click the <strong>Review + save</strong> button.</p>
<p>Click the <strong>Review + save</strong> button, then confirm the changes by checking the <strong>Confirm manifest changes</strong> checkbox and click the <strong>Save</strong> button.</p>
<p><img decoding="async" loading="lazy" alt="Fix ingress with copilot confirm" src="/aks-labs/assets/images/fix-ingress-with-copilot-confirm-ea0ff0d43eaa9b9feeef316004cb6c77.png" width="2512" height="1374" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="test-the-application-2">Test the application<a href="#test-the-application-2" class="hash-link" aria-label="Direct link to Test the application" title="Direct link to Test the application">​</a></h2>
<p>You should now be able to navigate to the web app.</p>
<p>Run the following command in your terminal to get the url of the web app.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;https://$(kubectl get ingress -n ccw web -o jsonpath=&#x27;{.spec.rules[0].host}&#x27;)&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Test the app again now and see if it works.</p>
<div class="tip" data-title="Hint"><blockquote>
<p>The web app is running but the api service is having issues. We will troubleshoot the api service in the next section.</p>
</blockquote></div>
<hr>
<h1>Debugging applications</h1>
<p>You may have noticed, the app is not working as expected. It seems to be stuck on <strong>Starting research agent task...</strong> and the api service is not processing the task.</p>
<p>We can use <a href="https://learn.microsoft.com/azure/azure-monitor/containers/container-insights-overview#access-container-insights" target="_blank" rel="noopener noreferrer">AKS Container Insights</a> to see what might be going wrong.</p>
<p>Navigate back to teh AKS portal, click on <strong>Workloads</strong>, then click the <strong>api</strong> deployment.</p>
<p>In the right-naviagtion pane, click on <strong>Live logs</strong>, then select a pod to view the logs.</p>
<div class="info" data-title="Note"><blockquote>
<p>It can take a few minutes for the logs to appear. If logs do not appear, try clicking the <strong>Looking for historical logs? View in Log Analytics</strong> link.</p>
</blockquote></div>
<p>Scroll through the logs and you will see that the api service is looking for details to authenticate to Azure OpenAI. We know from running this app locally that the api service uses the <a href="https://learn.microsoft.com/python/api/overview/azure/identity-readme?view=azure-python" target="_blank" rel="noopener noreferrer">Azure Identity SDK</a> to authenticate to Azure services. We need to configure the api service to use <a href="https://learn.microsoft.com/azure/aks/workload-identity-overview?tabs=python" target="_blank" rel="noopener noreferrer">AKS Workload Identity</a>.</p>
<p><img decoding="async" loading="lazy" alt="Fix api" src="/aks-labs/assets/images/api-logs-6b04ed788c9d40dfd6489609ace16105.png" width="2506" height="1391" class="img_ev3q"></p>
<hr>
<h1>Integrating apps with Azure services</h1>
<p>We need to configure the api service to use AKS Workload Identity. But configuring Workload Identity can be a bit tricky. We need to create an Azure Identity, give it permissions to access the Azure OpenAI service, create a Federated Credential for the AKS cluster, create a Kubernetes Service Account, and finally configure the api service to use the Kubernetes Service Account. That&#x27;s a lot of steps!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="workload-identity-with-aks-service-connector">Workload Identity with AKS Service Connector<a href="#workload-identity-with-aks-service-connector" class="hash-link" aria-label="Direct link to Workload Identity with AKS Service Connector" title="Direct link to Workload Identity with AKS Service Connector">​</a></h2>
<p><a href="https://learn.microsoft.com/azure/service-connector/how-to-use-service-connector-in-aks" target="_blank" rel="noopener noreferrer">AKS Service Connector</a> is a new feature that simplifies the configuration of Workload Identity.</p>
<div class="info" data-title="Note"><blockquote>
<p>At the time of this writing it is currently available as a preview feature, but is quickly becoming the preferred way to configure Workload Identity.</p>
</blockquote></div>
<p>It automatically gives an <a href="https://learn.microsoft.com/entra/identity/managed-identities-azure-resources/overview" target="_blank" rel="noopener noreferrer">Azure Managed Identity</a> the necessary permissions, and creates the <a href="https://learn.microsoft.com/graph/api/resources/federatedidentitycredentials-overview?view=graph-rest-1.0" target="_blank" rel="noopener noreferrer">Federated Credential</a> for the AKS cluster. All you need to do is create a Kubernetes <a href="https://kubernetes.io/docs/concepts/security/service-accounts/" target="_blank" rel="noopener noreferrer">ServiceAccount</a> and configure the api <a href="https://kubernetes.io/docs/concepts/security/service-accounts/#assign-to-pod" target="_blank" rel="noopener noreferrer">Pod</a> to use the Kubernetes ServiceAccount.</p>
<p>Let&#x27;s use the Azure portal to create a Service Connector.</p>
<p>In the AKS portal, click on <strong>Service Connector (Preview)</strong> under <strong>Settings</strong>.</p>
<p><img decoding="async" loading="lazy" alt="Service Connector" src="/aks-labs/assets/images/aks-service-connector-start-e48c7d64886298ce8aeb736a71018bdc.png" width="2506" height="1391" class="img_ev3q"></p>
<p>Click the <strong>Connect to your Services</strong> button.</p>
<p>In the <strong>Create connection</strong> pane, enter the following details:</p>
<p>In the <strong>Basics</strong> tab:</p>
<ul>
<li><strong>Kubernetes namesapce:</strong> ccw</li>
<li><strong>Service type:</strong> Select <strong>OpenAI Service</strong></li>
<li><strong>Connection name:</strong> Leave as default</li>
<li><strong>Subscription:</strong> Select your Azure subscription where the target service is located</li>
<li><strong>OpenAI:</strong> Select the OpenAI service</li>
<li><strong>Client type:</strong> Leave as default (None)</li>
</ul>
<p>Click <strong>Next: Authentication</strong></p>
<p><img decoding="async" loading="lazy" alt="Service Connector basics" src="/aks-labs/assets/images/aks-service-connector-basics-be909b3c4e930599d2e81464fbd977f9.png" width="2506" height="1391" class="img_ev3q"></p>
<p>In the <strong>Authentication</strong> tab:</p>
<ul>
<li><strong>Select authentication type:</strong> Select <strong>Workload Identity</strong></li>
<li><strong>Subscription:</strong> Select your Azure subscription where the target managed identity is located</li>
<li><strong>User assigned managed identity:</strong> Select the managed identity that was created for you (it&#x27;ll start with <code>identity-*</code>)</li>
</ul>
<p>Click <strong>Next: Networking</strong></p>
<p><img decoding="async" loading="lazy" alt="Service Connector authentication" src="/aks-labs/assets/images/aks-service-connector-auth-85a538b590085525da0d026d85503428.png" width="2506" height="1391" class="img_ev3q"></p>
<p>In the <strong>Networking</strong> tab, leave as default, then click <strong>Next: Review + Create</strong></p>
<p><img decoding="async" loading="lazy" alt="Service Connector network" src="/aks-labs/assets/images/aks-service-connector-net-2fe60d9cedbd85a619593256362635b9.png" width="2506" height="1391" class="img_ev3q"></p>
<p>In the <strong>Review + Create</strong> tab:</p>
<ul>
<li>Wait for the final validation</li>
<li>Review the details</li>
<li>Click <strong>Create</strong></li>
</ul>
<p>This will take a few minutes to create the Service Connector.</p>
<p><img decoding="async" loading="lazy" alt="Service Connector created" src="/aks-labs/assets/images/aks-service-connector-created-b1323fecb86fd31dd4372d95692ecca7.png" width="2506" height="1391" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="update-deployment-manifest">Update deployment manifest<a href="#update-deployment-manifest" class="hash-link" aria-label="Direct link to Update deployment manifest" title="Direct link to Update deployment manifest">​</a></h2>
<p>Deploying the Service Connector took care of the underlying infrastructure bits for you. All you have do now is update your api deployment manifest to enable workload identity and use the newly created Kubernetes ServiceAccount.</p>
<p>Not sure of where to add the configuration? No problem! The Service Connector can help you with that too.</p>
<p>When it is complete, check the checkbox next to the Service Connector, then click the <strong>Yaml snippet</strong> button to view a generic snippet. This gives you an idea of what you need to add to your deployment manifest. But we can actually do better than that. We can have the Service Connector make the changes for us.</p>
<p>Select <strong>Kubernetes Workload</strong> as the <strong>Resource Type</strong>.</p>
<p><img decoding="async" loading="lazy" alt="Service Connector resource" src="/aks-labs/assets/images/aks-service-connector-resource-6ece907ff0c8fe9c6910c6e444c39935.png" width="2506" height="1391" class="img_ev3q"></p>
<p>You will see a new dropdown appear. Select the <strong>api</strong> deployment from the <strong>Kubernetes Workload</strong> dropdown.</p>
<p>As you can see, the Service Connector is suggesting changes to the deployment manifest and highlighting the changes so you don&#x27;t miss them.</p>
<p><img decoding="async" loading="lazy" alt="Service Connector yaml snippet" src="/aks-labs/assets/images/aks-service-connector-yaml-7a25b2bee728ce91d6ed9a62bef9f6f1.png" width="2506" height="1391" class="img_ev3q"></p>
<p>Click the <strong>Apply</strong> button to apply the changes.</p>
<p>This will restart the api deployment with the new configuration.</p>
<p>Click on the <strong>Workloads</strong> tab, then click on the <strong>Pods</strong> tab to view the pods.</p>
<p>Filter by namespace <strong>ccw</strong> and you should see the api pod restarting.</p>
<p><img decoding="async" loading="lazy" alt="Service Connector pod restart" src="/aks-labs/assets/images/aks-service-connector-restart-871f1c46acd31e093c0affd1242c1f52.png" width="2506" height="1391" class="img_ev3q"></p>
<p>After a few minutes, the pod should be running.</p>
<p>Now we can retest the application.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="re-test-the-application">Re-test the application<a href="#re-test-the-application" class="hash-link" aria-label="Direct link to Re-test the application" title="Direct link to Re-test the application">​</a></h2>
<p>Navigate back to the web app and test the app again. You should see the app working as expected.</p>
<p><img decoding="async" loading="lazy" alt="Contoso creative writer on AKS" src="/aks-labs/assets/images/ccw-app-on-aks-21e64c0874a8c002c057e42c6d8232a2.png" width="2506" height="1391" class="img_ev3q"></p>
<hr>
<h1>Summary</h1>
<p>Congratulations! You have successfully containerized and deployed an AI workload to an AKS Automatic cluster. You have learned how to deploy an AKS Automatic cluster, create ConfigMaps, configure Automated Deployments to publish container images to ACR and deploy Kubernetes manifests, configure ingress, and troubleshoot an application using AKS Container Insights.</p>
<p>With AKS Automatic, we can see how many enterprise ready features are built-in and enabled by default. This allows you to focus on building and deploying your applications without having to worry about the underlying infrastructure. With the addition of AKS Service Connector, configuring Workload Identity is now easier than ever, and Automated Deployments make it easy to consistently deploy new versions of your application as soon as you push changes to your GitHub repository.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="next-steps">Next steps<a href="#next-steps" class="hash-link" aria-label="Direct link to Next steps" title="Direct link to Next steps">​</a></h2>
<p>Be sure to clean up your resources to avoid incurring any charges. You can do this by deleting the resource group in the Azure portal or running <code>azd down --force --purge</code> in your terminal.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="learn-more">Learn More<a href="#learn-more" class="hash-link" aria-label="Direct link to Learn More" title="Direct link to Learn More">​</a></h2>
<ul>
<li><a href="https://learn.microsoft.com/azure/ai-services/openai/overview" target="_blank" rel="noopener noreferrer">Azure OpenAI</a></li>
<li><a href="https://aka.ms/aks/automatic" target="_blank" rel="noopener noreferrer">AKS Automatic</a></li>
<li><a href="https://learn.microsoft.com/azure/aks/automated-deployments" target="_blank" rel="noopener noreferrer">AKS Automated Deployments</a></li>
<li><a href="https://learn.microsoft.com/azure/aks/app-routing" target="_blank" rel="noopener noreferrer">AKS App Routing Add-On</a></li>
<li><a href="https://learn.microsoft.com/azure/service-connector/how-to-use-service-connector-in-aks" target="_blank" rel="noopener noreferrer">AKS Service Connector</a></li>
<li><a href="https://docs.docker.com/get-started/docker-concepts/building-images/writing-a-dockerfile/" target="_blank" rel="noopener noreferrer">Writing a Dockerfile</a></li>
<li><a href="https://docs.docker.com/compose/" target="_blank" rel="noopener noreferrer">Docker Compose overview</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/Azure-Samples/aks-labs/tree/main/docs/ai-workloads-on-aks/workshop.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/aks-labs/docs/category/ai-on-aks"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">AI on AKS</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/aks-labs/docs/category/tutorial---basics"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Tutorial - Basics</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#objectives" class="table-of-contents__link toc-highlight">Objectives</a></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#fork-and-clone-the-repo" class="table-of-contents__link toc-highlight">Fork and clone the repo</a></li><li><a href="#deploy-azure-resources" class="table-of-contents__link toc-highlight">Deploy Azure Resources</a></li><li><a href="#local-development" class="table-of-contents__link toc-highlight">Local development</a></li><li><a href="#test-the-application" class="table-of-contents__link toc-highlight">Test the application</a></li><li><a href="#containerize-the-application" class="table-of-contents__link toc-highlight">Containerize the application</a><ul><li><a href="#exploring-the-docker-compose-file" class="table-of-contents__link toc-highlight">Exploring the Docker Compose file</a></li></ul></li><li><a href="#test-the-application-1" class="table-of-contents__link toc-highlight">Test the application</a></li><li><a href="#deploy-aks-automatic-cluster" class="table-of-contents__link toc-highlight">Deploy AKS Automatic cluster</a></li><li><a href="#publish-container-images" class="table-of-contents__link toc-highlight">Publish container images</a></li><li><a href="#application-configuration" class="table-of-contents__link toc-highlight">Application configuration</a></li><li><a href="#automated-deployments" class="table-of-contents__link toc-highlight">Automated deployments</a><ul><li><a href="#deploy-the-api-app" class="table-of-contents__link toc-highlight">Deploy the api app</a></li><li><a href="#deploy-the-web-app" class="table-of-contents__link toc-highlight">Deploy the web app</a></li><li><a href="#confirm-deployment" class="table-of-contents__link toc-highlight">Confirm deployment</a></li></ul></li><li><a href="#configure-ingress" class="table-of-contents__link toc-highlight">Configure ingress</a><ul><li><a href="#configure-ingress-for-web-service" class="table-of-contents__link toc-highlight">Configure ingress for web service</a></li><li><a href="#configure-ingress-for-api-service" class="table-of-contents__link toc-highlight">Configure ingress for api service</a></li><li><a href="#use-azure-copilot-to-fix-the-api-ingress" class="table-of-contents__link toc-highlight">Use Azure Copilot to fix the api ingress</a></li></ul></li><li><a href="#test-the-application-2" class="table-of-contents__link toc-highlight">Test the application</a></li><li><a href="#workload-identity-with-aks-service-connector" class="table-of-contents__link toc-highlight">Workload Identity with AKS Service Connector</a></li><li><a href="#update-deployment-manifest" class="table-of-contents__link toc-highlight">Update deployment manifest</a></li><li><a href="#re-test-the-application" class="table-of-contents__link toc-highlight">Re-test the application</a></li><li><a href="#next-steps" class="table-of-contents__link toc-highlight">Next steps</a></li><li><a href="#learn-more" class="table-of-contents__link toc-highlight">Learn More</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Microsoft. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>